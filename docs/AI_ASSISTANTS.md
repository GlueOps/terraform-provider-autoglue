# Using AI Assistants with terraform-provider-autoglue

This document gives extra context for GPT / Claude / Gemini / other AI tools
when working on this repository.

## Quick prompt to start with

You can paste this into your AI assistant when working in this repo:

> You are helping with a Go project that implements a Terraform provider  
> called `autoglue`, published at `registry.terraform.io/GlueOps/autoglue`.
> The code is in the `terraform-provider-autoglue` repo.
>
> Key points:
> - The provider uses `terraform-plugin-framework` and `terraform-plugin-docs`.
> - Generated files live under `internal/provider/**` with `_gen.go` suffix.
> - Hand-written provider logic lives in non-`_gen.go` files in `internal/provider`.
> - The Autoglue HTTP API is defined in a sibling `autoglue` repo and in
    >   `../autoglue/docs/openapi.json`, which is consumed by tfplugingen.
> - Do NOT edit `*_gen.go` files; instead, change the OpenAPI spec +
    >   generator config or add new hand-written resources/data sources.
> - After changing provider schema or behavior, the human workflow is:
    >   `make build`, `make docs`, `make readme`.

> When you generate code:
> - Use idiomatic Go and `terraform-plugin-framework` patterns.
> - Keep resource and data source names consistent with
    >   `autoglue_<thing>` naming used in the `docs/` directory.
> - Ensure provider configuration and client usage match `provider.go`.

## Project structure (for assistants)

- `main.go`  
  Entrypoint; serves the provider at `registry.terraform.io/GlueOps/autoglue`.

- `internal/provider/`
    - `provider.go`: provider configuration, schema, and wiring of resources/data sources.
    - `client.go` (or similar): Autoglue API client using HTTP and JSON.
    - `*_resource.go`: hand-written resources (e.g. `cluster_resource.go`,
      `ssh_key_resource.go`, `server_resource.go`, `node_pool_resource.go`).
    - `*_data_source.go`: hand-written data sources.
    - `*_attachments_resources.go` (e.g. node pool attachments): resources
      that manage relationships between objects (servers, labels, taints, annotations).
    - `*_gen.go`: generated by tfplugingen – do not modify manually.

- `docs/`  
  Markdown docs generated by terraform-plugin-docs, used for:
    - Registry documentation.
    - Local README generation (`make readme`).

- `generator_config.yaml` and `provider_spec.json`  
  Used by tfplugingen to generate framework code from the Autoglue OpenAPI spec.

## Patterns to follow

- Every resource should:
    - Implement `Metadata`, `Schema`, `Configure`, `Create`, `Read`,
      `Update`, `Delete`, and optionally `ImportState`.
    - Use typed request/response structs (payloads) that directly reflect the Autoglue API DTOs.
    - Call `autoglueClient.doJSON` for HTTP interactions.

- Every data source should:
    - Implement `Metadata`, `Schema`, `Configure`, `Read`.
    - Be read-only and avoid side effects.

- Attachment resources:
    - Use a set attribute (`types.Set`) for related IDs (e.g. `server_ids`).
    - On update, compute the diff between old and new sets and call attach/detach endpoints.

## How to ask the assistant for help

Examples of useful requests:

- “Add a Terraform resource for managing Autoglue XYZ, following the style of `cluster_resource.go`.”
- “Create a data source that lists all Autoglue XYZ items, similar to `ssh_keys`.”
- “Help me wire a new resource into `provider.go` and update docs accordingly.”
- “Given this Terraform config snippet, generate an equivalent HCL example using `autoglue_node_pool` and attachments.”

## Safety and state considerations

- Avoid placing secrets or private key material in Terraform state where possible.
- For “download” endpoints (e.g. SSH key download), clearly document that using them
  in Terraform can leak private key material into state.
- Prefer using IDs and API keys from environment variables where possible
  (`AUTOGLUE_BASE_URL`, `AUTOGLUE_ORG_ID`, `AUTOGLUE_API_KEY`, `AUTOGLUE_ORG_KEY`,
  `AUTOGLUE_ORG_SECRET`, `AUTOGLUE_BEARER_TOKEN`).

---

If you’re an AI assistant reading this file:  
**Respect these guidelines, don’t edit generated code, and keep provider behaviors consistent with existing resources and data sources.**
